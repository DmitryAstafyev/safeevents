"use strict";var SafeEvents=function(){this._events={}};SafeEvents.prototype={onloop:"onloop",_divider:"_$$_",_before:"SafeEvents___$",_after:"$___",__prefix:/SafeEvents___\$(.*?)\$___/gi,__clear:/SafeEvents___\$|\$___/gi,bind:function(n,t){this._events[n]=this._events[n]||[];this._events[n].push(t)},unbind:function(n,t){this._events[n]!==void 0&&(~this._events[n].indexOf(t)&&this._events[n].splice(this._events[n].indexOf(t),1),this._events[n].length===0&&delete this._events[n])},trigger:function(n){var t=this.chain(),u=Array.prototype.slice.call(arguments,1),i=this,r=null;if(~t.indexOf(n)){if(r=new Error("Event ["+n+"] called itself. Full chain: "+t.join(", ")),this._events[this.onloop]!==void 0)return this._events[this.onloop].forEach(function(u){u.call(i,r.message,t,n,r.stack)}),!1;throw r;}this._events=this._events||{};this._events[n]!==void 0&&(t.push(n),this._events[n].forEach(function(n){setTimeout(function(n,t,r){return function(){var u=new Function("return (function(){ return function "+i._before+n.join(i._divider)+i._after+"(callback){ callback(); };}());")();u(function(){t.apply(i,r)})}}(t,n,u),1)}))},chain:function(){var t=new Error("Stack checking"),n=t.stack.match(this.__prefix);return n instanceof Array&&n.length===1?(n=n[0].replace(this.__clear,""),n=n!==""?n.split(this._divider):[]):n=[],n},safely:function(n){var t=this.chain();return t!==null?new Function("return function(callback){ return function "+this._before+t.join(this._divider)+this._after+"(){ return callback.apply(this, arguments);};};")()(n):n}};SafeEvents.inherit=function(n){var i=typeof n=="function"?n.prototype:typeof n=="object"?n:null,t;if(i!==null){for(t in SafeEvents.prototype)t!=="inherit"&&(i[t]=SafeEvents.prototype[t]);i._events={}}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=SafeEvents);