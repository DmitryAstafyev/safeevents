"use strict";var SafeEvents=function(){this._events={handles:{},indexes:{},_indexes:{},index:0}};SafeEvents.prototype={onloop:"onloop",bind:function(n,t){this._events.handles[n]=this._events.handles[n]||[];this._events.handles[n].indexOf(t)===-1&&this._events.handles[n].push(t);this._events.indexes[n]===void 0&&(this._events.indexes[n]=this._events.index++);this._events._indexes[this._events.indexes[n]]=n},unbind:function(n,t){this._events.handles[n]!==void 0&&(~this._events.handles[n].indexOf(t)&&this._events.handles[n].splice(this._events.handles[n].indexOf(t),1),this._events.handles[n].length===0&&(delete this._events.handles[n],delete this._events._indexes[this._events.indexes[n]],delete this._events.indexes[n]))},trigger:function(n){var t=this.chain(n),f=Array.prototype.slice.call(arguments,1),u=this,i=null,r=null;if(t.loop)if(i=new Error("Event ["+n+"] called itself. Full chain: "+t.chain.join(", ")),this._events.handles[this.onloop]!==void 0){if(this._events.handles[this.onloop].forEach(function(f){var e=f.call(u,i.message,t.chain,n,i.stack);r=r?r:typeof e!="boolean"?!0:e}),r)return!1}else throw i;this._events.handles[n]!==void 0&&this._events.handles[n].forEach(function(i){setTimeout(function(t,i,r){return function(){var f=new Function("return (function(){ return function event_"+n.replace(/[^\w\d]/gi,"")+"_"+t+"(callback){ callback(); };}());")();f(function(){i.apply(u,r)})}}(t.func,i,f),1)})},chain:function(n){var e=new Error("SafeEvents checking"),t=e.stack.match(/\$\$\$(.*?)\$/gi),i=[],r="_",u=this,f=!1;return t instanceof Array&&t.length===1?(t=t[0].replace(/\$/gi,""),t=t!==""?t.split(r):[],i=t.map(function(n){return u._events._indexes[n]})):t=[],n!==null&&(~i.indexOf(n)&&(f=!0),i.push(n),t.push(u._events.indexes[n])),{chain:i,func:"$$$"+t.join(r)+"$",loop:f}},safely:function(n){var t=this.chain(null);return t.chain.length>0?new Function("return function(callback){ return function "+t.func+"(){ return callback.apply(this, arguments);};};")()(n):n}};SafeEvents.inherit=function(n){var i=typeof n=="function"?n.prototype:typeof n=="object"?n:null,t;if(i!==null){for(t in SafeEvents.prototype)t!=="inherit"&&(i[t]=SafeEvents.prototype[t]);i._events={handles:{},indexes:{},_indexes:{},index:0}}};typeof module!="undefined"&&module.exports!==void 0&&(module.exports=SafeEvents);